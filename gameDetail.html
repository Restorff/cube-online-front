<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="javaex/favicon.ico">
    <title>比赛详情</title>
    <!--字体图标-->
    <link href="javaex/pc/css/icomoon.css" rel="stylesheet" />
    <!--动画-->
    <link href="javaex/pc/css/animate.css" rel="stylesheet" />
    <!--骨架样式-->
    <link href="javaex/pc/css/common.css" rel="stylesheet" />
    <!--皮肤（缇娜）-->
    <link href="javaex/pc/css/skin/tina.css" rel="stylesheet" />
    <!--jquery，不可修改版本-->
    <script src="javaex/pc/lib/jquery-1.7.2.min.js"></script>
    <!--全局动态修改-->
    <script src="javaex/pc/js/common.js"></script>
    <!--核心组件-->
    <script src="javaex/pc/js/javaex.min.js"></script>
    <!--表单验证-->
    <script src="javaex/pc/js/javaex-formVerify.js"></script>
</head>
<style>
    .welcome {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 40px;
        margin-top: 10px;
    }
    
    .xiangmu {
        margin: auto;
        display: flex;
        flex-direction: column;
        margin-top: 50px;
        margin-left: 200px;
    }
    
    .submit {
        margin-left: 200px;
    }
    
    .tab-title {
        margin-top: 40px;
    }
</style>

<body>

    <!--全部主体内容-->
    <div class="list-content">

        <!--块元素-->
        <div class="block">
            <!--正文内容-->
            <div class="main">
                <!--选项卡切换-->
                <div id="tab" class="tab">
                    <div class="welcome">
                        欢迎来到CubeOnline比赛系统
                    </div>

                    <!--选项卡标题部分-->
                    <div class="tab-title">
                        <!--可以为选项卡添加图标、大标题、链接-->
                        <img class="mod-icon" src="http://img.javaex.cn/dm.png" />
                        <em><a href="#" target="_blank">&emsp;&emsp;&emsp;&emsp;<i style="color:#ccc">></i></a></em>
                        <ul>

                            <li><button class="button blue"><span class="icon-plus"></span> 可选项目</button></li>
                            <li><button class="button yellow"><span class="icon-close1"></span>已选项目</button></li>
                            <li><button class="button green"><span class="icon-check1"></span> 赛程</button></li>
                            <li><button class="button red"><span class="icon-check2"></span> 比赛规则</button></li>
                            <li><button class="button navy"><span class="icon-check2"></span> 赛果</button></li>

                            <!--可以为选项卡右上角添加链接-->
                            <a class="more" target="_blank" href="playLogin.html" @click="logout">退出登录</a>
                            <span class="clearfix"></span>
                        </ul>
                    </div>
                    <!--选项卡内容部分-->
                    <div class="tab-content">
                        <div class="choose">
                            <form id="form1">
                                <div class="box xiangmu">
                                    <input type="hidden" :value="this.apply.aId" name="aId">
                                    <input type="hidden" :value="this.cId" name="cId">
                                    <input type="hidden" :value="this.pId" name="pId">
                                    <label zoom="2" v-show="isShow1('e222')"><input type="checkbox"  value="1"  name="e222"/> &nbsp;二阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e333')"><input type="checkbox"  value="1"  name="e333"/> &nbsp;三阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e444')"><input type="checkbox"  value="1"  name="e444"/> &nbsp;四阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e555')"><input type="checkbox"  value="1"  name="e555"/> &nbsp;五阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e666')"><input type="checkbox"  value="1"  name="e666"/> &nbsp;六阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e777')"><input type="checkbox"  value="1"  name="e777"/> &nbsp;七阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e333bf')"><input type="checkbox"  value="1"  name="e333bf"/> &nbsp;三盲</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e333oh')"><input type="checkbox"  value="1"  name="e333oh"/> &nbsp;三单</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e333fm')"><input type="checkbox"  value="1"  name="e333fm"/> &nbsp;最少步</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('eclock')"><input type="checkbox"  value="1"  name="eclock"/> &nbsp;魔表</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('eminx')"><input type="checkbox"  value="1"  name="eminx"/> &nbsp;五魔方</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('epyram')"><input type="checkbox"  value="1"  name="epyram"/> &nbsp;金字塔</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('eskewb')"><input type="checkbox"  value="1"  name="eskewb"/> &nbsp;斜转</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('esq1')"><input type="checkbox"  value="1"  name="esq1"/> &nbsp;sq1</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e444bf')"><input type="checkbox"  value="1"  name="e444bf"/> &nbsp;四盲</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e555bf')"><input type="checkbox"  value="1"  name="e555bf"/> &nbsp;五盲</label>&nbsp;
                                    <label zoom="2" v-show="isShow1('e333mbf')"><input type="checkbox"  value="1"  name="e333mbf"/> &nbsp;三阶多盲</label>&nbsp;
                                </div>
                            </form>
                            <div class="submit">
                                <button class="button blue radius-8" id="save" @click="save()">增报项目</button>
                            </div>
                        </div>
                        <div class="checked">
                            <form id="form2">
                                <div class="box xiangmu">
                                    <label zoom="2" v-show="isShow2('e222')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e222"/> &nbsp;二阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e333')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e333"/> &nbsp;三阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e444')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e444"/> &nbsp;四阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e555')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e555"/> &nbsp;五阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e666')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e666"/> &nbsp;六阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e777')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e777"/> &nbsp;七阶</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e333bf')"><input checked disabled="disabled"  type="checkbox"  value="1"  name="e333bf"/> &nbsp;三盲</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e333oh')"><input checked disabled="disabled"  type="checkbox"  value="1"  name="e333oh"/> &nbsp;三单</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e333fm')"><input checked disabled="disabled"  type="checkbox"  value="1"  name="e333fm"/> &nbsp;最少步</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('eclock')"><input checked disabled="disabled"  type="checkbox"  value="1"  name="eclock"/> &nbsp;魔表</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('eminx')"><input  checked disabled="disabled" type="checkbox"  value="1"  name="eminx"/> &nbsp;五魔方</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('epyram')"><input checked disabled="disabled"  type="checkbox"  value="1"  name="epyram"/> &nbsp;金字塔</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('eskewb')"><input checked disabled="disabled"  type="checkbox"  value="1"  name="eskewb"/> &nbsp;斜转</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('esq1')"><input  checked disabled="disabled"type="checkbox"  value="1"  name="esq1"/> &nbsp;sq1</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e444bf')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e444bf"/> &nbsp;四盲</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e555bf')"><input  checked disabled="disabled"type="checkbox"  value="1"  name="e555bf"/> &nbsp;五盲</label>&nbsp;
                                    <label zoom="2" v-show="isShow2('e333mbf')"><input checked disabled="disabled" type="checkbox"  value="1"  name="e333mbf"/> &nbsp;三阶多盲</label>&nbsp;
                                </div>
                            </form>
                            <div class="submit">
                                <button class="button blue radius-8">暂不支持退赛，快去练习把！</button>
                            </div>
                        </div>
                        <div><img :src="this.competition.schedule" /></div>
                        <div><a target="_blank" href="https://www.worldcubeassociation.org/regulations/translations/chinese/">详细比赛规则请点击</a></div>
                        <div><a @click="toGameResults()">点击跳转到赛果界面</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <script>
        new Vue({
            el: ".list-content",
            data: {
                apply: {},
                competition: {},
                pId: "",
                cId: "",
            },
            mounted: function() {
                var playUser = sessionStorage.getItem('playUser');
                if (playUser == null) {
                    javaex.message({
                        content: "当前权限不足，请登录后操作",
                        type: "error"
                    });
                    setTimeout(function() {
                        location.href = "playLogin.html"
                    }, 2000);
                    return;
                }
                if (this.getUrlParam("pId") != null) {
                    this.checkGame();
                }
                this.manageGame();
            },
            methods: {
                logout() {
                    sessionStorage.removeItem('playUser');
                    window.location.href = "/playLogin.html";
                },
                getUrlParam(name) {
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                    var r = window.location.search.substr(1).match(reg); //匹配目标参数
                    if (r != null) return decodeURI(r[2]);
                    return null; //返回参数值
                },
                checkGame: function() {
                    var _this = this;
                    //查询报名情况
                    axios.get("http://cube-online.lstf666.cn:8083/Cube-Online/player/queryEvents?cId=" + this.getUrlParam("cId") + "&pId=" + this.getUrlParam("pId") + "").then(
                        function(response) {
                            _this.apply = response.data.apply;
                            _this.pId = _this.getUrlParam("pId");
                            _this.cId = _this.getUrlParam("cId");
                            console.log(response.data.apply);
                        }
                    ).catch(
                        function(error) {
                            console.log("发生了错误：" + error);
                        })
                },
                manageGame() {
                    var _this = this;
                    //查询比赛项目开设情况
                    axios.get("http://cube-online.lstf666.cn:8083/Cube-Online/admin/manage?cId=" + this.getUrlParam("cId") + "")
                        .then(function(res) {
                            _this.competition = res.data.data;
                            console.log(res);
                        }, function(err) {
                            console.log(err);
                        })
                },
                isShow1(event) {
                    //展示开设 且 未报名
                    if (this.competition[event] != '0' && this.apply[event] == '0') {
                        return true;
                    }
                    return false;
                },
                isShow2(event) {
                    //展示报名项目
                    if (this.apply[event] == '1') {
                        return true;
                    }
                    return false;
                },
                save() {
                    // http://localhost:8084/player/addApply
                    var data = $("#form1").serialize();
                    axios.post("http://cube-online.lstf666.cn:8083/Cube-Online/player/addApply", data)
                        .then(function(res) {
                            javaex.message({
                                content: "你的参赛信息已变更",
                                type: "success"
                            });
                            setTimeout(function() {
                                window.location.reload()
                            }, 1000);

                        }, function(err) {
                            console.log(err);
                        })
                },
                toGameResults() {
                    location.href = "gameResults.html?cId=" + this.getUrlParam("cId") + "";
                }
            }
        })
    </script>
    <script>
        javaex.tab({
            id: "tab", // tab的id
            current: 1, // 默认选中第几个选项卡
            mode: "mouseover", // 鼠标移动切换选项卡
            // 切换选项卡后返回一个对象，包含选项卡的索引，从1开始计
            // 初始化会自动执行一次
            callback: function(rtn) {
                console.log(rtn.index);
            }
        });
    </script>
</body>

</html>